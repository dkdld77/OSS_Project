import datetime
import sys

# ìš°ë¦¬ê°€ ë§Œë“  ëª¨ë“ˆë“¤ ê°€ì ¸ì˜¤ê¸°
from modules import weather, scraper, ai_summ

def main():
    print("=== ğŸ¤– AI ì •ë³´ ì•Œë¦¼ ë´‡ ê°€ë™ ===")
    
    # ------------------------------------------------
    # 1. ë‚ ì”¨ ì •ë³´ ìˆ˜ì§‘ (íŒ€ì› 1 ì½”ë“œ ì‚¬ìš©)
    # ------------------------------------------------
    print("\n1. ë‚ ì”¨ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤...")
    weather_data = weather.get_weather("Seoul")
    print(f"   -> ì™„ë£Œ: {weather_data}")

    # ------------------------------------------------
    # 2. ë‰´ìŠ¤ í¬ë¡¤ë§ (íŒ€ì› 2 ì½”ë“œ ì‚¬ìš©)
    # ------------------------------------------------
    print("\n2. ìµœì‹  ê¸°ìˆ  ë‰´ìŠ¤ë¥¼ í¬ë¡¤ë§í•©ë‹ˆë‹¤...")
    news_data = scraper.fetch_python_news()
    
    if news_data:
        print(f"   -> ì™„ë£Œ: '{news_data['title']}' (ë³¸ë¬¸ {len(news_data['content'])}ì)")
        
        # ------------------------------------------------
        # 3. AI ìš”ì•½ (íŒ€ì› 3 ì½”ë“œ ì‚¬ìš©)
        # ------------------------------------------------
        print("\n3. ë³¸ë¬¸ ë‚´ìš©ì„ AIê°€ ìš”ì•½í•©ë‹ˆë‹¤...")
        summary_text = ai_summ.summarize_text(news_data['content'])
        print("   -> AI ìš”ì•½ ì™„ë£Œ")
        
    else:
        news_data = {"title": "ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹¤íŒ¨", "url": "", "content": ""}
        summary_text = "ë‰´ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•´ ìš”ì•½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

    # ------------------------------------------------
    # 4. ë¦¬í¬íŠ¸ ìƒì„± ë° ì €ì¥ (íŒ€ì› 4 ë¡œì§)
    # ------------------------------------------------
    print("\n4. ë¦¬í¬íŠ¸ ì‘ì„± ì¤‘...")
    
    now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    final_report = f"""
##################################################
        DAILY AI INTELLIGENCE REPORT
        ë°œí–‰ì¼ì‹œ: {now}
##################################################

[ğŸŒ¤ï¸ ì˜¤ëŠ˜ì˜ ë‚ ì”¨]
{weather_data}

--------------------------------------------------

[ğŸ“° ìµœì‹  Python ë‰´ìŠ¤]
ì œëª©: {news_data.get('title')}
ë§í¬: {news_data.get('url')}

[ğŸ¤– AI ìš”ì•½ ë‚´ìš©]
{summary_text}

##################################################
    """
    
    # íŒŒì¼ ì €ì¥
    filename = "daily_report.txt"
    with open(filename, "w", encoding="utf-8") as f:
        f.write(final_report)
        
    print(f"\nâœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ! '{filename}' íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")

if __name__ == "__main__":
    main()
